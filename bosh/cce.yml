- path: /instance_groups/name=bosh/jobs/-
  type: replace
  value:
    name: pre-start-script
    properties:
      script: |-
        #!/bin/bash
        sed -i "$(grep -Rn 'PASS_MAX_DAYS' /etc/login.defs | grep 99999 | awk -F"[:]" '{ print $1 }')s/99999/90/"  /etc/login.defs
        chage -M 90 root
        chage -M 90 vcap
        chage -M 90 jumpbox
        chmod o-w /var/tmp
        ln -sf /usr/share/zoneinfo/Asia/Seoul /etc/localtime
        sed -i'' -r -e "/keepalive_timeout/i\  disable_symlinks    on;" /var/vcap/jobs/blobstore/config/nginx.conf
        sed -i'' -r -e "/keepalive_timeout/i\  disable_symlinks    on;" /var/vcap/jobs/director/config/nginx.conf
        echo "added disable_symlinks in nginx.conf"
        mkdir -p /var/vcap/data/director/tmp/html
        sed -i'' -r -e "/listen 25555 /i\    root    /var/vcap/data/director/tmp/html;" /var/vcap/jobs/director/config/nginx.conf
        echo "added root default config  in nginx.conf"
        cd  /lib/x86_64-linux-gnu/
        ln -s libreadline.so.7.0 libreadline.so.6
        echo "modified libreadline-so-6-issue-in-ubuntu-18-04"
    release: os-conf

- path: /instance_groups/name=bosh/jobs/-
  type: replace
  value:
    name: common_script
    properties:
      post_start_script: |-
        #!/bin/bash
          echo "starting commont_script/post_start_script"
          if [ -d /var/vcap/data/uaa/tomcat/webapps/ROOT ]; then
            chmod -R 700 /var/vcap/data/uaa/tomcat/webapps
            echo "chmod -R 700 tomcat files"
          else
            echo "where is ROOT?"
          fi
          echo "finished common_script/post_start_script"
    release: paasta-conf

- path: /instance_groups/name=bosh/jobs/-
  type: replace
  value:
    name: postgres_conf
    release: paasta-conf
    properties:
      cce_enable: true

- path: /instance_groups/name=bosh/jobs/-
  type: replace
  value:
    name: sysctl
    release: os-conf
    properties:
      sysctl:
      - net.ipv4.tcp_timestamps=0

- type: replace
  path: /instance_groups/name=bosh/jobs/name=postgres-10
  value:
    name: postgres-cce
    release: bosh

- type: replace
  path: /releases/name=bosh?
  value:
    name: bosh
    sha1: 74a0e35ecf385047e56d8474a08598ad87e52bf2
    url: https://nextcloud.paas-ta.org/index.php/s/KbMyfnnCMPJi2NH/download
    version: 271.11.0-PaaS-TA

# aws stemcell
#- type: replace
#  path: /resource_pools/name=vms/stemcell?
#  type: replace
#  value:
#    name: stemcell
#    sha1: 8a31bb5e4c337f562335c0575682724d5b422f4b
#    url: https://storage.googleapis.com/bosh-aws-light-stemcells/1.34/light-bosh-stemcell-1.34-aws-xen-hvm-ubuntu-bionic-go_agent.tgz

# azure stemcell
#- type: replace
#  path: /resource_pools/name=vms/stemcell?
#  type: replace
#  value:
#    name: stemcell
#    sha1: 6182d7c70bf8ead6d1c3f9d46638a8e2e27759e8
#    url: https://storage.googleapis.com/bosh-core-stemcells/1.34/bosh-stemcell-1.34-azure-hyperv-ubuntu-bionic-go_agent.tgz

# gcp stemcell
#- type: replace
#  path: /resource_pools/name=vms/stemcell?
#  type: replace
#  value:
#    name: stemcell
#    sha1: c7a10928d65bf423f74fb070b068bd8d5f986165
#    url: https://storage.googleapis.com/bosh-gce-light-stemcells/1.34/light-bosh-stemcell-1.34-google-kvm-ubuntu-bionic-go_agent.tgz

# openstack stemcell
- type: replace
  path: /resource_pools/name=vms/stemcell?
  type: replace
  value:
    name: stemcell
    sha1: 2f16587f3d7f6374f706f1e321e7a437ddf0ab9f
    url: https://storage.googleapis.com/bosh-core-stemcells/1.34/bosh-stemcell-1.34-openstack-kvm-ubuntu-bionic-go_agent.tgz

# vsphere stemcell
#- type: replace
#  path: /resource_pools/name=vms/stemcell?
#  type: replace
#  value:
#    name: stemcell
#    sha1: 69f9bfe7517a848f28f443f2833b287d7a692177
#    url: https://storage.googleapis.com/bosh-core-stemcells/1.34/bosh-stemcell-1.34-vsphere-esxi-ubuntu-bionic-go_agent.tgz


- type: replace
  path: /instance_groups/name=bosh/properties/postgres/cce_enable?
  value: true

- type: replace
  path: /releases/name=paasta-conf?
  value:
    name: paasta-conf
    sha1: 182e06c6a09d1af2e4386c16126fcee6731979d7
    url: https://nextcloud.paas-ta.org/index.php/s/JjRiiZMpYtLXKck/download
    version: 1.0.2

- type: replace
  path: /instance_groups/name=bosh/jobs/-
  value:
    name: tomcat_conf
    release: paasta-conf
    properties:
      cce_enable: true


