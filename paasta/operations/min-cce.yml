---
# set paasta-conf release
- type: replace
  path: /releases/name=paasta-conf?
  value:
    name: paasta-conf
    url:  https://nextcloud.paas-ta.org/index.php/s/TqKAsxz83PiMoXF/download
    version: 1.0.5

- type: replace
  path: /releases/name=postgres?
  value:
    name: postgres
    sha1: eda6c862c0edde443381199a750d28774b06bb31
    url:  https://nextcloud.paas-ta.org/index.php/s/znqQxgMaWTPQL4B/download
    version: 43-PaaS-TA-v4

# CCE - UAA tomcat patch
- type: replace
  path: /instance_groups/name=control/jobs/-
  value:
    name: tomcat_conf
    release: paasta-conf
    properties:
      cce_enable: true

# CCE - diego-cell tomcat patch
- type: replace
  path: /instance_groups/name=compute/jobs/-
  value:
    name: tomcat_conf
    release: paasta-conf
    properties:
      cce_enable: true

# CCE - PaaS-TA postgres set password
- type: replace
  path: /variables/-
  value:
    name: cf_postgres_admin_password
    type: password

# CCE - PaaS-TA database patch
- type: replace
  path: /instance_groups/name=database/jobs/-
  value:
    name: paasta_db_conf
    release: paasta-conf
    properties:
      cce_enable: true
      postgres_admin_password: ((cf_postgres_admin_password))
      database:
        port: ((paasta_database_port))

# CCE - PaaS-TA uaa patch
- type: replace
  path: /instance_groups/name=control/jobs/name=uaa/properties/uaa/servlet?
  value:
    idle-timeout: 600

# CCE - PaaS-TA control vm addon common_script 
- type: remove
  path: /addons/name=min-configuration?

# CCE - PaaS-TA api/nginx patch
- type: replace
  path: /instance_groups/name=control/jobs/-
  value:
    name: common_script
    release: paasta-conf
    properties:
      pre_start_script: |+
        #!/bin/bash
        mount -o remount,size=32m /var/vcap/data/sys/run
        sed -i'' -r -e "/keepalive_timeout/i\  disable_symlinks    on;" /var/vcap/jobs/cloud_controller_ng/config/nginx.conf
        echo "added disable_symlinks in nginx.conf"
        mkdir -p /var/vcap/data/cloud_controller_ng/tmp/html
        sed -i'' -r -e "/listen    9022;/i\    root    /var/vcap/data/cloud_controller_ng/tmp/html;" /var/vcap/jobs/cloud_controller_ng/config/nginx.conf
        echo "added root default config  in nginx.conf"

# CCE - PaaS-TA blobstore/nginx patch
- type: replace
  path: /instance_groups/name=database/jobs/-
  value:
    name: common_script
    release: paasta-conf
    properties:
      pre_start_script: |+
        #!/bin/bash
        sed -i'' -r -e "/keepalive_timeout/i\  disable_symlinks    on;" /var/vcap/jobs/blobstore/config/nginx.conf
        echo "added disable_symlinks in nginx.conf"

# CCE - Release replace
- type: replace
  path: /releases/name=capi
  value:
    name: capi
    sha1: 24633dcc64a3369eecdc1b12372c0777efa3ed8f
    url: https://nextcloud.paas-ta.org/index.php/s/B2Db4Ym4erssTAT/download
    version: 1.123.0-PaaS-TA

# CCE - Release replace
#- type: replace
#  path: /releases/name=cf-networking
#  value:
#    name: cf-networking
#    sha1: 0f23bfea4c036b9cf8352d7b3bf78a8ae75c2448
#    url: https://nextcloud.paas-ta.org/index.php/s/kNw82LWRnPZSNiF/download
#    version: 2.36.0-PaaS-TA

# CCE - Release replace
#- type: replace
#  path: /releases/name=diego
#  value:
#    name: diego
#    sha1: d7cd8b1bce9d50dea0196b1b73dd675126cfb06f
#    url: https://nextcloud.paas-ta.org/index.php/s/KQ7g7BgLCjqNHzC/download
#    version: 2.49.0-PaaS-TA

# CCE - Release replace
- type: replace
  path: /releases/name=routing
  value:
    name: routing
    sha1: 240395b382c8607c59b37e1d58c46567c9b311cf
    url: https://nextcloud.paas-ta.org/index.php/s/DjH4HH3aEkGY98Q/download
    version: 0.228.0-PaaS-TA

# CCE - Release replace
#- type: replace
#  path: /releases/name=silk
#  value:
#    name: silk
#    sha1: 20d21af238f4a620dacad67be32bb98f2e2fdde7
#    url: https://nextcloud.paas-ta.org/index.php/s/oJfRCNEsrx2QQWJ/download
#    version: 2.36.0-PaaS-TA

# CCE - Release replace
- type: replace
  path: /releases/name=uaa
  value:
    name: uaa
    sha1: 72beceffd33d326acb9b7bfa88bb18e8a8f6aaf8
    url: https://nextcloud.paas-ta.org/index.php/s/dZ2EtD45Z7fkcWH/download
    version: 75.20.0-PaaS-TA

# CCE - Release replace
- type: replace
  path: /releases/name=pxc
  value:
    name: pxc
    sha1: eae46c8c30d81e3ee4fde428b77466eff8136326
    url: https://nextcloud.paas-ta.org/index.php/s/JBbAD2ZYCAyBP5M/download
    version: 0.42.0-PaaS-TA

# CCE - Release replace
- type: replace
  path: /releases/name=credhub
  value:
    name: credhub
    sha1: 8792e336dfa79705e5bee1d73042cf4a30fd7965
    url: https://nextcloud.paas-ta.org/index.php/s/B8oR4LH4EkeEN9Q/download
    version: 2.11.1-PaaS-TA

# CVE - Release replace
- type: replace
  path: /releases/name=php-buildpack
  value:
    name: php-buildpack
    sha1: 5dcb1988bdfaa67a334aa7c5aa0dcf95873bc362
    url: https://bosh.io/d/github.com/cloudfoundry/php-buildpack-release?v=4.4.55
    version: 4.4.55
    

# CVE - Release replace
- type: replace
  path: /releases/name=java-buildpack
  value:
    name: java-buildpack
    sha1: 62199cc3aa4dff2e2aa75db89daad13542c5e9c6
    url: https://bosh.io/d/github.com/cloudfoundry/java-buildpack-release?v=4.48.3
    version: 4.48.3

# CVE - Release replace
- type: replace
  path: /releases/name=haproxy?
  value:
    name: haproxy
    sha1: b1ea172e97562ac785a28b3614655b5a77552d8f
    url: https://bosh.io/d/github.com/cloudfoundry-incubator/haproxy-boshrelease?v=11.11.0
    version: 11.11.0
